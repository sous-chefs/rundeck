##############################################################################
# This file is autogenerated by chef                                         #
#                                                                            #
# Collectd Cassandra/Java plugin configuration file                          #
#----------------------------------------------------------------------------#
# By: Josh Behrends - Webtrends 2012                                         #
#                                                                            #
# Revisions: 5/4/2012 - Initial script creation                              #
#                                                                            #
##############################################################################
LoadPlugin java

<Plugin "java">
	JVMArg "-verbose:jni"
	JVMArg "-Djava.class.path=/usr/share/collectd/java/collectd-api.jar:/usr/share/collectd/java/generic-jmx.jar"
	LoadPlugin "org.collectd.java.GenericJMX"

	<Plugin "GenericJMX">
	################
	# MBean blocks #
	################
	# Memory usage by memory pool.
	<MBean "memory_pool">
		ObjectName "java.lang:type=MemoryPool,*"
		InstancePrefix "memory_pool-"
		InstanceFrom "name"
		<Value>
			Type "memory"
			#InstancePrefix ""
			#InstanceFrom ""
			Table true
			Attribute "Usage"
		</Value>
	</MBean>	
	# Heap memory usage
	<MBean "memory-heap">
		ObjectName "java.lang:type=Memory"
		#InstanceFrom ""
		InstancePrefix "memory-heap"  
		# Creates four values: committed, init, max, used
		<Value>
			Type "memory"  
			#InstancePrefix ""
			#InstanceFrom ""
			Table true
			Attribute "HeapMemoryUsage"
		</Value>
	</MBean>
	# Non-heap memory usage
	<MBean "memory_nonheap">
		ObjectName "java.lang:type=Memory"
		#InstanceFrom ""
		InstancePrefix "memory-nonheap"
		# Creates four values: committed, init, max, used
		<Value>
			Type "memory"
			#InstancePrefix ""
			#InstanceFrom ""
			Table true
			Attribute "NonHeapMemoryUsage"
		</Value>
	</MBean>
	# Non-heap memory usage
	<MBean "java_threads">
		ObjectName "java.lang:type=Threading"
		#InstanceFrom ""
		InstancePrefix "java_threads"
		<Value>
			Type "gauge"
			InstancePrefix "ThreadCount"
			#InstanceFrom ""
			Attribute "ThreadCount"
		</Value>
	</MBean>	
	# Garbage Collector stats
	<MBean "garbage_collector">
		ObjectName "java.lang:type=GarbageCollector,*"
		InstancePrefix "gc-"
		InstanceFrom "name"
		<Value>
			Type "invocations"
			InstancePrefix "collection_count"
			#InstanceFrom ""
			Table false
			Attribute "CollectionCount"
		</Value>
		<Value>
			Type "total_time_in_ms"
			InstancePrefix "collection_time"
			#InstanceFrom ""
			Table false
			Attribute "CollectionTime"
		</Value>
	</MBean>
	# Number of classes being loaded.
	<MBean "classes">
		ObjectName "java.lang:type=ClassLoading"
		InstancePrefix "loaded_classes"
		#InstanceFrom ""
		<Value>
			Type "gauge"
			InstancePrefix "loaded_classes"
			#InstanceFrom ""
			Table false
			Attribute "LoadedClassCount"
		</Value>
	</MBean>
	# java runtime attributes
	<MBean "runtime">
		ObjectName "java.lang:type=Runtime"
		InstancePrefix "runtime"
		#InstanceFrom ""
		<Value>
			Type "gauge"
			InstancePrefix "JVM_uptime"
			#InstanceFrom ""
			Table false
			Attribute "Uptime"
		</Value>
	</MBean>
	#WT Cassandra CF Polling
	<MBean "cassandra-cf-Webtrends">
		ObjectName "org.apache.cassandra.db:type=ColumnFamilies,keyspace=Webtrends,columnfamily=*"
		InstancePrefix "CAS-"
		InstanceFrom "columnfamily"
		<Value>
			Type "counter"
			InstancePrefix "ReadCount"
			Attribute "ReadCount"
		</Value>
        <Value>
            Type "counter"
            InstancePrefix "WriteCount"
            Attribute "WriteCount"
        </Value>
        <Value>
			Type "gauge"
			InstancePrefix "PendingTasks"
			Attribute "PendingTasks"
        </Value>
		<Value>
			Type "counter"
			InstancePrefix "TotalWriteLatencyMicros"
			Attribute "TotalWriteLatencyMicros"
		</Value>
		<Value>
			Type "counter"
			InstancePrefix "TotalReadLatencyMicros"
			Attribute "TotalReadLatencyMicros"
		</Value>
		<Value>
			Type "gauge"
			InstancePrefix "LiveDiskSpaceUsed"
			Attribute "LiveDiskSpaceUsed"
		</Value>			
	</MBean>
	#WT Cassandra Cache Polling
	<MBean "cassandra-cache-Webtrends">
		ObjectName "org.apache.cassandra.db:type=Caches,keyspace=Webtrends,cache=*"
		InstancePrefix "CAS-"
		InstanceFrom "cache"
		<Value>
			Type "gauge"
			InstancePrefix "RecentHitRate"
			Attribute "RecentHitRate"
		</Value>
	</MBean>
	#Compaction Pending Tasks
	<MBean "compaction-manager">
		ObjectName "org.apache.cassandra.db:type=CompactionManager"
		#InstancePrefix ""
		InstanceFrom "type"
		<Value>
			Type "gauge"
			InstancePrefix "PendingTasks"
			Attribute "PendingTasks"
		</Value>
		<Value>
			Type "gauge"
			InstancePrefix "CompletedTasks"
			Attribute "CompletedTasks"
		</Value>
	</MBean>
	#####################
	# Connection blocks #
	#####################
	<Connection>
		Host "<%= @node[:hostname] %>"
		ServiceURL "service:jmx:rmi:///jndi/rmi://localhost:7199/jmxrmi"
		Collect "classes"
		Collect "memory-heap"
		Collect "memory_nonheap"
		Collect "java_threads"
		Collect "garbage_collector"
		Collect "runtime"
		Collect "cassandra-cf-Webtrends"
		Collect "cassandra-cache-Webtrends"
		Collect "compaction-manager"
	</Connection>
	</Plugin>
</Plugin>

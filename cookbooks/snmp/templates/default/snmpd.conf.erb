<%# Copyright 2010, Eric G. Wolfe %>
<%# License: Apache 2.0 %>
# Generated by Chef for <%= node['fqdn'] %>
# Local modifications will be overwritten.
###############################################################################
#
# snmpd.conf:
#   An example configuration file for configuring the ucd-snmp snmpd agent.
#
###############################################################################

###############################################################################
# Access Control
###############################################################################

####
# First, map the community string into a "security name"

#       sec.name  source          community
com2sec notConfigUser  default       <%= node['snmp']['community'] %> 

####
# Second, map the security name into a group name:

#       groupName      securityModel securityName
group   notConfigGroup v1            notConfigUser
group   notConfigGroup v2c           notConfigUser

####
# Third, create a view for us to let the group have rights to:

# Make at least  snmpwalk -v 1 localhost -c public system fast again.
#       name           incl/excl     subtree         mask(optional)
<% if node['snmp']['full_systemview'] %>
view    systemview    included   .1
<% end %>
view    systemview    included   .1.3.6.1.2.1.1
view    systemview    included   .1.3.6.1.2.1.25.1.1

####
# Finally, grant the group read-only access to the systemview view.

#       group          context sec.model sec.level prefix read   write  notif
access  notConfigGroup ""      any       noauth    exact  systemview none none

###############################################################################
# System contact information
#

# It is also possible to set the sysContact and sysLocation system
# variables through the snmpd.conf file:

<% if node['virtualization']['role'] == "guest" %>
syslocation <%= node['snmp']['syslocationVirtual'] %>
<% else %>
syslocation <%= node['snmp']['syslocationPhysical'] %>
<% end %>
syscontact <%= node['snmp']['syscontact'] %> 

# Added for support of bcm5820 cards.
pass .1.3.6.1.4.1.4413.4.1 /usr/bin/ucd5820stat

<% if node['dmi']['system']['manufacturer'] =~ /dell/i %>
# Allow Systems Management Data Engine SNMP to connect to snmpd using SMUX
smuxpeer .1.3.6.1.4.1.674.10892.1
<% end %>

###############################################################################
# Trap communities and trapsinks 
#
#  See the snmpd.conf manual page, and the output of "snmpd -H".
<% unless node['snmp']['trapsinks'].empty? %>
trapcommunity <%= node['snmp']['trapcommunity'] %>
<% node['snmp']['trapsinks'].each do |trapsink| %>
trapsink <%= trapsink %>
<% end %>
<% end %>

<% if node['snmp']['is_dnsserver'] %>
###############################################################################
# Extend Section
#
# extend example to collect DNS RNDC stats
extend bindSuccess /usr/local/bin/snmp_rndc_stats.pl --success
extend bindReferral /usr/local/bin/snmp_rndc_stats.pl --referral
extend bindNxrrset /usr/local/bin/snmp_rndc_stats.pl --nxrrset
extend bindNxdomain /usr/local/bin/snmp_rndc_stats.pl --nxdomain
extend bindRecursion /usr/local/bin/snmp_rndc_stats.pl --recursion
extend bindFailure /usr/local/bin/snmp_rndc_stats.pl --failure
<% end %>
